<html>
    <head>
        <meta http-equiv="content-type" content="text/html; charset=UTF-8">
        <link rel="stylesheet" href="theke:/default.css" type="text/css">
        <link rel="stylesheet" href="theke:/bible.css" type="text/css">

        <title>{{ ref.bookName }} {{ ref.chapter }}</title>
    </head>
    <body>
        <h1>{{ ref.bookName }} {{ ref.chapter }}</h1>

        <bdi id="content" lang="{{ lang }}">
        {% for verse in verses %}
        {% if loop.index == ref.verse %}
        <p class="em"><sup>{{ loop.index }}</sup>{{ verse }}</p>
        {% else%}
        <p><sup>{{ loop.index }}</sup>{{ verse }}</p>
        {% endif%}
        {% endfor %}
        </bdi>

        <script>
        var currentWord;

        function handle_click_on_word(evt) {
            morph = evt.target.getAttribute("morph");

            if (morph != null) {
                // Unselect previous word
                if (currentWord != null) {
                    currentWord.classList.remove("selected");
                }
                
                // Select this word
                currentWord = evt.target;
                currentWord.classList.add("selected");

                // Send its morphology out of the webview
                r = "sword:/signal/morph/" + morph.replace(/\//g, '_');
                fetch(r);
            }
        }

        document.getElementById("content").addEventListener('click', handle_click_on_word);
        </script>
    </body>
</html>